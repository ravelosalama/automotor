DROP TRIGGER [STATUS FACTURA ANULADA]
GO


CREATE TRIGGER [STATUS FACTURA ANULADA] ON [dbo].[SAFACT] 
FOR INSERT 
AS

-- ACTUALIZA CAMPOS STATUS Y LIQUIDACION CON 'ANULADA' Y NRO NC
-- POR DEVULCION EN VENTA DE VEHICULOS

DECLARE @CODOPER VARCHAR(10)
DECLARE @NUMEROD VARCHAR(20)
DECLARE @TIPOFAC VARCHAR(1)
DECLARE @FACT_AFEC VARCHAR(20)

BEGIN
SELECT  @CODOPER=CODOPER, @NUMEROD=NUMEROD, @TIPOFAC=TIPOFAC, @FACT_AFEC=NUMEROR  FROM INSERTED

IF @TIPOFAC = 'B' AND @CODOPER='01-101'

UPDATE    SAFACT_01
SET   STATUS = 'ANULADA', LIQUIDACION=@NUMEROD
WHERE     SAFACT_01.NUMEROD=@FACT_AFEC AND SAFACT_01.TIPOFAC = 'A'

END


 
