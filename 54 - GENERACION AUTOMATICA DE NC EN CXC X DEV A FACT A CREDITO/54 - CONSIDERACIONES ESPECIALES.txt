LA SOLUCION CONSISTE EN LOGRAR TRES OBJETIVOS 

1RO. CREAR UN QUERY QUE ESTUDIE POR DEVOLUCIONES EFECTUADAS BUSQUE EN LA CXC 
LA FACTURA AFECTADA Y SI SE ENCUENTRA PENDIENTE CREARLE UN REGISTRO DE NC QUE LA CANCELE
CON LOS MISMOS DATOS DE LA DEVOLUCION

-- query que estudia las devoluciones efectuadas 

SELECT     x.TipoFac, x.NumeroD, x.NumeroR, x.Monto, x.MtoTax, x.TGravable, y.Monto AS Expr1, y.MontoNeto, y.MtoTax AS Expr2, y.Saldo, 
                      y.NumeroD AS Expr3, y.TipoCxc, y.document
FROM         SAFACT x INNER JOIN
                      SAACXC y ON x.NumeroR = y.NumeroD AND x.CodClie = y.CodClie
WHERE     (x.TipoFac = 'b') AND (y.TipoCxc = '10')



-- QUERY QUE LIMPIA LAS CXC EN FUNCION A LAS DEVOLUCIONES

UPDATE    SAACXC
SET              DOCUMENT = DOCUMENT + '/NC:' + X.NUMEROD, SALDO = 0
FROM         SAFACT x INNER JOIN
                      SAACXC y ON x.NumeroR = y.NumeroD AND x.CodClie = y.CodClie
WHERE     (x.TipoFac = 'b') AND (y.TipoCxc = '10')





2DO. CREAR UN PROCEDIMIENTO DESENCADENADOR QUE CUANDO SE GENERE UNA DOVOLUCION A UNA FACTURA A CREDITO
LA MISMA GENERE LA NC EN CXC LIMPIANDO LA CUENTA.


EN LA EVALAUACION DE LA 8731 SE VERIFICO QUE SI SE PUEDE REALIZAR LA NC DESDE LA DEVOLUCION SOLO HAY QUE VALIDAR QUE EL USUARIO LA UTILICE OBLIGATORIAMENTE
Y CERRAR LA POSIBILIDAD DE GENERAR NOTAS DE CREDITO DESDE EL ADMINISTRATIVO SOLO SI PREVIAMENTE SE HACE EL MISMO CONNSECUTIVO PARA NC Y DEV
SE CORRE EL RIESGO DE QUE SE DANE EL LIBRO DE VENTA CON EL CONSECUTIVO DE NC SI SE LLEGASE HACER ALGUNA POR EL ADMINISTRATIVO.
se verifico que al hacer anticipo el sistema toma el mismo consecutivo de nc que afecta el consecutivo de devolucion lo que obliga a que se desvinculen para que
cada consecutivo siga por su cuenta.


3RO CRUCE LAS FACTURAS PENDIENTES CON LOS SALDOS EN ANTICIPOS. (OJO CON ESTE PROCEDIMIENTO HAY QUE ESTUDIARLO BIEN)


PREPARAR Y DEPURAR TABLAS

ACTUALIZAR NUMEROR CON NOTAS 6 SOLO CUANDO NUMEROR ES NULL

VERICAR EN SAFACT SI LOS REGISTROS A Y B ESTAN CRUZADOS CON SUS RESPECTIVOS NUMEROS DE DOCUMENTOS LO QUE NO ESTEN CRUZARLOS



SAFACT SE FILTRA POR DEVOLUCIONES
LAS MISMAS RECOGE LA FACTURA AFECTADA Y LA BUSCA EN CXC SI ESTA PENDIENTE GENERA LA NC Y LA CANCELA
SI NO GENERA LA NC PARA LA DEVOLCION DEL DINERO. POR BANCO / CAJA.


